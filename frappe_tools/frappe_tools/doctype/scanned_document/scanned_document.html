<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <style>
        @page {
            size: A4;
            margin: 8mm;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #fff;
        }

        .printable-page {
            page-break-after: always;
            width: 100%;
            box-sizing: border-box;
        }

        .header {
            margin-bottom: 6mm;
        }

        .section-title {
            font-size: 12pt;
            font-weight: bold;
            border-bottom: 1px solid #333;
            margin-bottom: 2mm;
        }

        .page-meta {
            font-size: 9pt;
            color: #555;
        }

        .image-box {
            width: 100%;
            height: 240mm;
            border: 1px solid #ccc;
            overflow: hidden;
            text-align: center;
        }

        .image-box img {
            max-width: 100%;
            max-height: 100%;
            display: block;
            margin: auto;
        }

        .placeholder {
            width: 100%;
            height: 100%;
            border: 1px dashed #ddd;
        }
    </style>
</head>

<body>

{% for section_name, section in data.sections.items() %}

    {# Group images by logical page_no #}
    {% for page_no, images in section.images | groupby("page_no") %}

        {# Determine if both front & back exist #}
        {% set page_types = images | map(attribute="page_type") | list %}
        {% set show_page_type = page_types | length > 1 %}

        {# Explicit Front → Back order #}
        {% for desired_type in ["Front", "Back"] %}
            {% for img in images %}
                {% if img.page_type == desired_type %}

                <div class="printable-page">

                    <div class="header">
                        <div class="section-title">{{ section_name }}</div>
                        <div class="page-meta">
                            Page {{ page_no }}
                            {% if show_page_type %}
                                — {{ img.page_type }}
                            {% endif %}
                        </div>
                    </div>

                    <div class="image-box">
                        {% if img.attachment %}
                            <img src="{{ img.attachment }}">
                        {% else %}
                            <div class="placeholder"></div>
                        {% endif %}
                    </div>

                </div>

                {% endif %}
            {% endfor %}
        {% endfor %}

    {% endfor %}
{% endfor %}

</body>
</html>
